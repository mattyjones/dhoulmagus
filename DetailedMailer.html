<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: DetailedMailer
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!DetailedMailer.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (D)</a> &raquo;
    
    
    <span class="title">DetailedMailer</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: DetailedMailer
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Sensu::Handler</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sensu::Handler</li>
          
            <li class="next">DetailedMailer</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">bin/handler-detailed-mailer.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Create a well formed universal html email message using json and erb
templates</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_check_state_duration-instance_method" title="#define_check_state_duration (instance method)">- (string) <strong>define_check_state_duration</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Calculate the duration the check has been it its current state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_notification_type-instance_method" title="#define_notification_type (instance method)">- (string) <strong>define_notification_type</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define the type of alert this is.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_sensu_env-instance_method" title="#define_sensu_env (instance method)">- (string) <strong>define_sensu_env</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define the operating environment of the device being monitored.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_source-instance_method" title="#define_source (instance method)">- (string) <strong>define_source</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define the source of the email.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#define_status-instance_method" title="#define_status (instance method)">- (string) <strong>define_status</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Convert the integer value given by Sensu into a text string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_setting-instance_method" title="#get_setting (instance method)">- (string) <strong>get_setting</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Acquires the mail settings from a json file dropped via Chef.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle-instance_method" title="#handle (instance method)">- (integer) <strong>handle</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create the email and ship it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#short_name-instance_method" title="#short_name (instance method)">- (string) <strong>short_name</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define a short name for the alert to be used in log files.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#template_vars-instance_method" title="#template_vars (instance method)">- (hash) <strong>template_vars</strong>(source) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Define all erb template variables.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="define_check_state_duration-instance_method">
  
    - (<tt>string</tt>) <strong>define_check_state_duration</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Calculate the duration the check has been it its current state</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get how long a check has been in a give state</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>define_check_state_duration</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the length of time a check has been in its current state</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_check_state_duration'>define_check_state_duration</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_notification_type-instance_method">
  
    - (<tt>string</tt>) <strong>define_notification_type</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define the type of alert this is</p>

<p>This will be used in both the email subject and in the `Notification Type:`
field</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set the notification type to FLAPPINF</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>define_notification_type</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;FLAPPING</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the notification type</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_notification_type'>define_notification_type</span>
  <span class='kw'>case</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>action</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>resolve</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CLEAR</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>create</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ALERT</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>flapping</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>FLAPPING</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NOTICE</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_sensu_env-instance_method">
  
    - (<tt>string</tt>) <strong>define_sensu_env</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define the operating environment of the device being monitored</p>

<p>This is not where the server is located, but where the client is located.
The client could be sending its checks to any regin/cluster/env so we need
to know where the actual device is located</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set the sensu environment to Dev:</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>define_sensu_env</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;Dev: &#39;&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The environemnt the client is associated with</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 113</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_sensu_env'>define_sensu_env</span>
  <span class='id identifier rubyid_sensu_server'>sensu_server</span> <span class='op'>=</span> <span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_gethostname'>gethostname</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_sensu_server'>sensu_server</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^prd</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Prod: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_sensu_server'>sensu_server</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^dev</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Dev: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_sensu_server'>sensu_server</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^FOO</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Stg: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_sensu_server'>sensu_server</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^BAR</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>KitchenCI: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_sensu_server'>sensu_server</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^vagrant</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Vagrant: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Test: </span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_source-instance_method">
  
    - (<tt>string</tt>) <strong>define_source</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define the source of the email</p>

<p>The email could be generated by any number of applications using its api,
each application needs to be defined here for filtering purposes</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set the source application to sensu</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>define_source</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;sensu&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The application interacting with the mailer</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 138</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_source'>define_source</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensu</span><span class='tstring_end'>&#39;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="define_status-instance_method">
  
    - (<tt>string</tt>) <strong>define_status</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Convert the integer value given by Sensu into a text string</p>

<p>This will be used in both the email subject and in the `Check State:` field</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set the status of the check to WARNING</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>define_status</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;WARNING</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The status of the check</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_define_status'>define_status</span>
  <span class='kw'>case</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>status</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='int'>0</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>OK</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>WARNING</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>2</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CRITICAL</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>3</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>UNKNOWN</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>127</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>CONFIG ERROR</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ERROR</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_setting-instance_method">
  
    - (<tt>string</tt>) <strong>get_setting</strong>(name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Acquires the mail settings from a json file dropped via Chef</p>

<p>These settings will set who the mail should be set to along with any
necessary snmtp settings.  All can be overridden in the local Vagrantfile</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get a setting</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>get_setting(&#39;mail_to&#39;)</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;user@purple.com&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the mail settings to use</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the configuration string</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 36</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_settings'>settings</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>devops-mailer</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle-instance_method">
  
    - (<tt>integer</tt>) <strong>handle</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create the email and ship it</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Set the notification type to CRITICAL</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>handle</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;A well-formed email notification to a recipent&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>exit code</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle'>handle</span>
  <span class='comment'>######################
</span>  <span class='comment'>#                    #
</span>  <span class='comment'># smtp mail settings #
</span>  <span class='comment'>#                    #
</span>  <span class='comment'>######################
</span>  <span class='id identifier rubyid_mail_to'>mail_to</span>                   <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail_to</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mail_from'>mail_from</span>                 <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail_from</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_delivery_method'>delivery_method</span>           <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>delivery_method</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_smtp_address'>smtp_address</span>              <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_address</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_smtp_port'>smtp_port</span>                 <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_port</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>25</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_smtp_domain'>smtp_domain</span>               <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_domain</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>localhost.localdomain</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_smtp_username'>smtp_username</span>             <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_username</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_smtp_password'>smtp_password</span>             <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_password</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_smtp_authentication'>smtp_authentication</span>       <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_authentication</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='symbol'>:plain</span>
  <span class='id identifier rubyid_smtp_enable_starttls_auto'>smtp_enable_starttls_auto</span> <span class='op'>=</span> <span class='id identifier rubyid_get_setting'>get_setting</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>smtp_enable_starttls_auto</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>false</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='kw'>true</span>

  <span class='comment'># set the source application to define the proper template variables
</span>  <span class='id identifier rubyid_source'>source</span> <span class='op'>=</span> <span class='id identifier rubyid_define_source'>define_source</span>

  <span class='comment'>###################################
</span>  <span class='comment'>#                                 #
</span>  <span class='comment'># create and render the email msg #
</span>  <span class='comment'>#                                 #
</span>  <span class='comment'>###################################
</span>  <span class='id identifier rubyid_gem_base'>gem_base</span> <span class='op'>=</span> <span class='backtick'>`</span><span class='tstring_content'>/opt/sensu/embedded/bin/gem environment gemdir</span><span class='tstring_end'>`</span></span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@template_path</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_gem_base'>gem_base</span><span class='embexpr_end'>}</span><span class='tstring_content'>/gems/dhoulmagus-</span><span class='embexpr_beg'>#{</span><span class='const'>Dhoulmagus</span><span class='op'>::</span><span class='const'>Version</span><span class='op'>::</span><span class='const'>STRING</span><span class='embexpr_end'>}</span><span class='tstring_content'>/templates</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_template_vars'>template_vars</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_renderer'>renderer</span> <span class='op'>=</span> <span class='const'>ERB</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail_template</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_renderer'>renderer</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span><span class='lparen'>(</span><span class='id identifier rubyid_binding'>binding</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mail_subject'>mail_subject</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_define_sensu_env'>define_sensu_env</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_define_notification_type'>define_notification_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monitored_instance</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_state</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'>#####################################
</span>  <span class='comment'>#                                   #
</span>  <span class='comment'># deliver the email and log it to   #
</span>  <span class='comment'># /var/log/sensu/sensu-server       #
</span>  <span class='comment'>#                                   #
</span>  <span class='comment'>#####################################
</span>  <span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_defaults'>defaults</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_delivery_options'>delivery_options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>address:</span> <span class='id identifier rubyid_smtp_address'>smtp_address</span><span class='comma'>,</span>
      <span class='label'>port:</span> <span class='id identifier rubyid_smtp_port'>smtp_port</span><span class='comma'>,</span>
      <span class='label'>domain:</span> <span class='id identifier rubyid_smtp_domain'>smtp_domain</span><span class='comma'>,</span>
      <span class='label'>openssl_verify_mode:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>none</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>enable_starttls_auto:</span> <span class='id identifier rubyid_smtp_enable_starttls_auto'>smtp_enable_starttls_auto</span>
    <span class='rbrace'>}</span>

    <span class='kw'>unless</span> <span class='id identifier rubyid_smtp_username'>smtp_username</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='id identifier rubyid_auth_options'>auth_options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
        <span class='label'>user_name:</span> <span class='id identifier rubyid_smtp_username'>smtp_username</span><span class='comma'>,</span>
        <span class='label'>password:</span> <span class='id identifier rubyid_smtp_password'>smtp_password</span><span class='comma'>,</span>
        <span class='label'>authentication:</span> <span class='id identifier rubyid_smtp_authentication'>smtp_authentication</span>
      <span class='rbrace'>}</span>
      <span class='id identifier rubyid_delivery_options'>delivery_options</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span> <span class='id identifier rubyid_auth_options'>auth_options</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_delivery_method'>delivery_method</span> <span class='id identifier rubyid_delivery_method'>delivery_method</span><span class='period'>.</span><span class='id identifier rubyid_intern'>intern</span><span class='comma'>,</span> <span class='id identifier rubyid_delivery_options'>delivery_options</span>
  <span class='kw'>end</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_timeout'>timeout</span> <span class='int'>10</span> <span class='kw'>do</span>
      <span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_deliver'>deliver</span> <span class='kw'>do</span>
        <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_mail_to'>mail_to</span>
        <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_mail_from'>mail_from</span>
        <span class='id identifier rubyid_subject'>subject</span> <span class='id identifier rubyid_mail_subject'>mail_subject</span>
        <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>text/html; charset=UTF-8</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_body'>body</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail -- sent alert for </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_short_name'>short_name</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> to </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_mail_to'>mail_to</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail -- timed out while attempting to </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_define_notification_type'>define_notification_type</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> an incident -- </span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_short_name'>short_name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="short_name-instance_method">
  
    - (<tt>string</tt>) <strong>short_name</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define a short name for the alert to be used in log files</p>

<p>This will be used in log files to track the execution of the mailer It can
currently be found in `/var/log/sensu/sensu-server.log`</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Get a string with the name and check in it</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>short_name</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;dev-foo/cpu-load&quot;</span></code></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>a string consisting of the device being alerted on and the check name</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 56</span>

<span class='kw'>def</span> <span class='id identifier rubyid_short_name'>short_name</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monitored_instance</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="template_vars-instance_method">
  
    - (<tt>hash</tt>) <strong>template_vars</strong>(source) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Define all erb template variables</p>

<p>This will determine what values to calculate for the templates</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'>
<p>Create the template var hash</p>
</div></p>
      
      <pre class="example code"><code><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>template_vars(sensu)</span><span class='tstring_end'>&quot;</span></span> <span class='comment'>#=&gt; &quot;@sensu_config&quot;</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>source</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>the source application</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>All values to be dropped into the email template</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'>
<p>0.0.1</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'bin/handler-detailed-mailer.rb', line 150</span>

<span class='kw'>def</span> <span class='id identifier rubyid_template_vars'>template_vars</span><span class='lparen'>(</span><span class='id identifier rubyid_source'>source</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_source'>source</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensu</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@sensu_config</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monitored_instance</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>client</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='comment'># this will be the snmp host if using traps
</span>      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensu_client</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>client</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>incident_timestamp</span><span class='tstring_end'>&#39;</span></span>    <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>issued</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>instance_address</span><span class='tstring_end'>&#39;</span></span>      <span class='op'>=&gt;</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>client</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>address</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_name</span><span class='tstring_end'>&#39;</span></span>            <span class='op'>=&gt;</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_state</span><span class='tstring_end'>&#39;</span></span>           <span class='op'>=&gt;</span> <span class='id identifier rubyid_define_status'>define_status</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_data</span><span class='tstring_end'>&#39;</span></span>            <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='comment'># any additional user supplied data
</span>      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notification_comment</span><span class='tstring_end'>&#39;</span></span>  <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='comment'># the comment added to a check to silence it
</span>      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notification_author</span><span class='tstring_end'>&#39;</span></span>   <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='comment'># the user that silenced the check
</span>      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_output</span><span class='tstring_end'>&#39;</span></span>          <span class='op'>=&gt;</span> <span class='ivar'>@event</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>output</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>sensu_env</span><span class='tstring_end'>&#39;</span></span>             <span class='op'>=&gt;</span> <span class='id identifier rubyid_define_sensu_env'>define_sensu_env</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>notification_type</span><span class='tstring_end'>&#39;</span></span>     <span class='op'>=&gt;</span> <span class='id identifier rubyid_define_notification_type'>define_notification_type</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_state_duration</span><span class='tstring_end'>&#39;</span></span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_define_check_state_duration'>define_check_state_duration</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mail_template</span><span class='tstring_end'>&#39;</span></span>         <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@template_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>/sensu/base_email.erb</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span>
    <span class='ivar'>@mail_subject</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_define_sensu_env'>define_sensu_env</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_define_notification_type'>define_notification_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_name</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>monitored_instance</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> is </span><span class='embexpr_beg'>#{</span><span class='ivar'>@sensu_config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>check_state</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Thu Aug 20 15:51:27 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.3).
</div>

  </body>
</html>